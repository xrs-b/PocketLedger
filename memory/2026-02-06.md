# 2026-02-06

## PocketLedger 部署问题追踪

### 问题现象
- 前端所有 API 请求 (http://localhost/api/v1/...) 返回 404
- 直接访问后端 http://localhost:8000/api/v1/health 可能正常

### 根因分析
1. **Nginx 代理问题**: frontend 容器无法通过 `http://backend:8000` 访问后端
2. **Docker 网络问题**: 容器间网络隔离，`backend` 主机名无法解析

### 修复方案
在 docker-compose.yml 中添加明确网络配置:
```yaml
networks:
  pocketledger_network:
    driver: bridge
```

并在每个服务中添加:
```yaml
networks:
  - pocketledger_network
```

### 提交记录
- `f406818` - fix: 添加明确的网络配置 pocketledger_network

### 待验证
需要在服务器执行:
```bash
docker-compose down --volumes --rmi all
docker-compose up -d --build
```

### 其他部署修复记录
| 修复项 | 提交 | 说明 |
|--------|------|------|
| nginx.conf 路径 | 78a1c7a | 修复 COPY 路径 |
| main.py 位置 | 41ae0b7 | 确保文件在 /code/backend/ |
| 数据库配置 | 2f2bca4 | 添加 MYSQL_* 环境变量 |
| 一键部署脚本 | e9cab88 | deploy.sh |

## 老细的反馈
- "我真的累了，部署各种问题" - 对反复出现的部署问题感到沮丧
- 提供了云服务器信息要求代为部署
- IP: 45.147.26.191, 端口: 60080, 用户: root
